<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NJRA Respiratory Policy Portal</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Firebase Connection -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc, onSnapshot, query, orderBy, where } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";

        // --- LIVE DATABASE CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyAefsgDE8YT1MLwC0wTEsFB799vKbStgyk",
            authDomain: "njra-policies.firebaseapp.com",
            projectId: "njra-policies",
            storageBucket: "njra-policies.firebasestorage.app",
            messagingSenderId: "779465511706",
            appId: "1:779465511706:web:d3fb672bcc89f168d892a3",
            measurementId: "G-2046SMFN0T"
        };
        
        window.isDemoMode = false;

        try {
            const app = initializeApp(firebaseConfig);
            window.db = getFirestore(app);
            window.auth = getAuth(app);
            
            // Expose services
            window.collection = collection;
            window.addDoc = addDoc;
            window.getDocs = getDocs;
            window.updateDoc = updateDoc;
            window.deleteDoc = deleteDoc;
            window.doc = doc;
            window.onSnapshot = onSnapshot;
            window.query = query;
            window.orderBy = orderBy;
            window.where = where;
            window.signInAnonymously = signInAnonymously;
            
            console.log("Firebase Connected");
        } catch (e) {
            console.error("Firebase Init Error:", e);
            window.isDemoMode = true; 
        }
    </script>

    <script>
        tailwind.config = {
            corePlugins: { preflight: false }, 
            theme: {
                extend: {
                    colors: {
                        njra: { 
                            50: '#fdf2f2',
                            100: '#fde8e8',
                            500: '#af3030',  // PRIMARY RED
                            600: '#942626',
                            900: '#444444'   // SECONDARY GRAY
                        }
                    }
                }
            }
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap');
        
        /* --- CORE APP CONTAINER --- */
        #njra-app-root {
            font-family: 'Lato', sans-serif;
            background-color: #f8fafc;
            color: #444444;
            line-height: 1.5;
            box-sizing: border-box;
            
            /* RESET to standard fluid width */
            width: 100%;
            display: block;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
            
            /* Ensure no margins push it out */
            margin: 0;
            padding: 0;
        }
        
        /* Inner content wrapper to keep padding consistent */
        .njra-inner-content {
            width: 100%;
            max-width: 100%;
            margin: 0;
        }

        #njra-app-root *, #njra-app-root *::before, #njra-app-root *::after { box-sizing: inherit; }

        /* --- BUTTON OVERRIDES --- */
        .njra-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s;
            border: none;
            text-decoration: none;
        }
        
        .njra-btn-primary {
            background-color: #af3030 !important; /* RED */
            color: #ffffff !important;
        }
        .njra-btn-primary:hover {
            background-color: #942626 !important;
        }

        .njra-btn-secondary {
            background-color: #444444 !important; /* DARK GRAY */
            color: #ffffff !important;
        }
        .njra-btn-secondary:hover {
            background-color: #000000 !important;
        }

        .njra-btn-outline {
            background-color: #e2e8f0 !important; /* LIGHT GRAY */
            color: #444444 !important;
            border: 1px solid #94a3b8 !important;
        }
        .njra-btn-outline:hover {
            background-color: #cbd5e1 !important;
        }
        
        .njra-btn-danger {
            background-color: #dc2626 !important;
            color: white !important;
        }
        .njra-btn-danger:hover {
            background-color: #b91c1c !important;
        }

        /* --- TYPOGRAPHY RESETS --- */
        #njra-app-root h1 { font-size: 2em; font-weight: 700; margin-bottom: 0.5em; line-height: 1.2; margin-top: 0; color: #af3030; }
        #njra-app-root h2 { font-size: 1.5em; font-weight: 600; margin-bottom: 0.5em; line-height: 1.3; margin-top: 1em; color: #444444; }
        #njra-app-root h3 { font-size: 1.17em; font-weight: 600; margin-bottom: 0.5em; color: #444444; }
        #njra-app-root p { margin-bottom: 1em; margin-top: 0; }
        #njra-app-root ul, #njra-app-root ol { margin-bottom: 1em; padding-left: 1.5em; margin-top: 0; }
        #njra-app-root ul { list-style-type: disc; }
        #njra-app-root ol { list-style-type: decimal; }
        #njra-app-root input, #njra-app-root textarea { color: #333; }
        
        /* Policy Content Styling */
        .policy-content h1 { color: #af3030; border-bottom: 2px solid #fbd5d5; padding-bottom: 0.2em; margin-top: 1.5em; }
        .policy-content h2 { color: #444444; margin-top: 1.5em; border-bottom: 1px solid #e5e7eb; padding-bottom: 5px; }
        .policy-content strong { font-weight: 700; color: #222; }

        @media print {
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            body { background: white; color: black; }
            #njra-app-root { border: none; width: 100% !important; margin: 0 !important; }
        }
        .print-only { display: none; }
    </style>
</head>
<body>
    <div id="njra-app-root">
        <div style="padding: 60px; text-align: center; color: #af3030;">
            <i class="fas fa-circle-notch fa-spin fa-2x"></i>
            <p style="margin-top: 15px; color: #444; font-weight: bold;">Loading NJRA Portal...</p>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const App = () => {
            const [view, setView] = useState('home');
            const [policies, setPolicies] = useState([]);
            const [selectedPolicy, setSelectedPolicy] = useState(null);
            const [isAdmin, setIsAdmin] = useState(false);
            const [showAdminLogin, setShowAdminLogin] = useState(false);
            const [adminPass, setAdminPass] = useState("");
            const [status, setStatus] = useState("Connecting...");
            const [showImport, setShowImport] = useState(false);
            const [importText, setImportText] = useState("");

            useEffect(() => {
                const init = async () => {
                    setTimeout(() => {
                        if(status === "Connecting...") setStatus("Connecting...");
                    }, 2000);

                    try {
                        if (window.auth && window.db) {
                            await window.signInAnonymously(window.auth);
                            const q = window.query(window.collection(window.db, 'policies'), window.orderBy('title'));
                            window.onSnapshot(q, (snapshot) => {
                                const loaded = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                                setPolicies(loaded);
                                setStatus(""); 
                            }, (error) => {
                                console.error("DB Error:", error);
                                setStatus("Error: " + error.message);
                            });
                        } else {
                            setStatus("System initializing...");
                        }
                    } catch (e) {
                        console.error("Init Error:", e);
                        setStatus("Connection Error: " + e.message);
                    }
                };
                
                const params = new URLSearchParams(window.location.search);
                const codeParam = params.get('code');
                const path = window.location.pathname.toLowerCase();
                init();
            }, []);

            const handleImport = async () => {
                try {
                    const data = JSON.parse(importText);
                    if (!Array.isArray(data)) throw new Error("Data must be a list [...]");
                    if(!confirm(`Processing ${data.length} policies... Continue?`)) return;
                    setStatus("Analyzing Import...");
                    let addedCount = 0;
                    let updatedCount = 0;
                    for(let item of data) {
                        let exists = false;
                        let existingId = null;
                        if (item.code) {
                            const q = window.query(window.collection(window.db, 'policies'), window.where('code', '==', item.code));
                            const snapshot = await window.getDocs(q);
                            if (!snapshot.empty) { exists = true; existingId = snapshot.docs[0].id; }
                        }
                        if (exists) { await window.updateDoc(window.doc(window.db, 'policies', existingId), item); updatedCount++; } 
                        else { await window.addDoc(window.collection(window.db, 'policies'), item); addedCount++; }
                    }
                    setStatus("");
                    alert(`Import Complete!\n\nNew: ${addedCount}\nUpdated: ${updatedCount}`);
                    setShowImport(false);
                    setImportText("");
                } catch(e) { alert("Import Failed: " + e.message); setStatus(""); }
            };

            const handleDelete = async (id) => {
                if(!confirm("Delete this policy permanently?")) return;
                try { await window.deleteDoc(window.doc(window.db, 'policies', id)); } 
                catch(e) { alert("Delete failed: " + e.message); }
            };

            const PolicyList = ({ policies, onSelectPolicy }) => {
                const [searchTerm, setSearchTerm] = useState("");
                const [viewMode, setViewMode] = useState('list'); 

                const filteredPolicies = policies.filter(p => 
                    p.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    (p.code && p.code.toLowerCase().includes(searchTerm.toLowerCase()))
                );

                // Sort by Code, then Title
                filteredPolicies.sort((a, b) => {
                    const codeA = a.code || "";
                    const codeB = b.code || "";
                    return codeA.localeCompare(codeB) || a.title.localeCompare(b.title);
                });

                return (
                    <div className="w-full">
                        {/* Hero / Search Section */}
                        <div className="text-center mb-8 bg-white p-8 rounded-lg shadow-sm border border-gray-200">
                            <h1 className="text-3xl font-bold text-njra-500 mb-2">Policy Database</h1>
                            <p className="text-gray-500 mb-6">Search respiratory therapy protocols and competencies.</p>
                            
                            <div className="max-w-xl mx-auto relative">
                                <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-gray-400">
                                    <i className="fas fa-search text-lg"></i>
                                </div>
                                <input
                                    type="text"
                                    className="block w-full pl-12 pr-4 py-3 border-2 border-gray-200 rounded-full leading-5 bg-gray-50 placeholder-gray-400 focus:outline-none focus:border-njra-500 focus:ring-1 focus:ring-njra-500 transition-all text-base shadow-sm"
                                    placeholder="Search by keyword or code..."
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                />
                            </div>
                        </div>

                        {/* Controls header */}
                        <div className="flex justify-between items-center mb-4 px-1">
                            <h2 className="text-lg font-bold text-gray-700 flex items-center">
                                Table of Contents 
                                <span className="ml-3 text-xs font-normal text-gray-500 bg-gray-200 px-2 py-1 rounded-full">{filteredPolicies.length} Documents</span>
                            </h2>
                            
                            <div className="flex bg-white p-1 rounded-md border border-gray-300 shadow-sm">
                                <button 
                                    onClick={() => setViewMode('list')}
                                    className={`px-3 py-1 rounded text-sm font-medium flex items-center transition-all ${viewMode === 'list' ? 'bg-njra-50 text-njra-500' : 'text-gray-400 hover:text-gray-600'}`}
                                    title="List View"
                                >
                                    <i className="fas fa-list"></i>
                                </button>
                                <button 
                                    onClick={() => setViewMode('grid')}
                                    className={`px-3 py-1 rounded text-sm font-medium flex items-center transition-all ${viewMode === 'grid' ? 'bg-njra-50 text-njra-500' : 'text-gray-400 hover:text-gray-600'}`}
                                    title="Grid View"
                                >
                                    <i className="fas fa-th-large"></i>
                                </button>
                            </div>
                        </div>

                        {/* Content Display */}
                        {viewMode === 'grid' ? (
                            <div className="grid gap-6 md:grid-cols-2 lg:grid-cols-3 w-full">
                                {filteredPolicies.map(p => (
                                    <div key={p.id} onClick={() => onSelectPolicy(p)} className="bg-white p-6 rounded-lg border border-gray-200 shadow-sm cursor-pointer hover:shadow-lg hover:border-njra-500 transition-all group">
                                        <div className="flex items-center mb-4">
                                            <div className="bg-njra-50 p-3 rounded-md text-njra-500 group-hover:bg-njra-500 group-hover:text-white transition-colors"><i className="fas fa-file-medical text-xl"></i></div>
                                            <div className="ml-4 overflow-hidden">
                                                <div className="text-xs text-gray-500 font-mono">{p.code}</div>
                                                <div className="font-bold text-njra-900 truncate">{p.title}</div>
                                            </div>
                                        </div>
                                        <div className="text-njra-500 text-sm font-bold group-hover:translate-x-1 transition-transform inline-block">View Policy &rarr;</div>
                                    </div>
                                ))}
                            </div>
                        ) : (
                            <div className="bg-white shadow-sm border border-gray-200 rounded-lg overflow-hidden">
                                <table className="min-w-full divide-y divide-gray-200">
                                    <thead className="bg-gray-50">
                                        <tr>
                                            <th scope="col" className="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider w-24">Code</th>
                                            <th scope="col" className="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Policy Title</th>
                                            <th scope="col" className="px-6 py-3 text-right text-xs font-bold text-gray-500 uppercase tracking-wider w-32">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody className="bg-white divide-y divide-gray-200">
                                        {filteredPolicies.map((policy, idx) => (
                                            <tr 
                                                key={policy.id} 
                                                onClick={() => onSelectPolicy(policy)} 
                                                className={`cursor-pointer transition-colors ${idx % 2 === 0 ? 'bg-white' : 'bg-gray-50/50'} hover:bg-njra-50`}
                                            >
                                                <td className="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-500">{policy.code || '-'}</td>
                                                <td className="px-6 py-4 text-sm text-gray-900 font-medium">{policy.title}</td>
                                                <td className="px-6 py-4 whitespace-nowrap text-right text-sm">
                                                    <span className="text-njra-500 hover:text-njra-600 font-bold flex items-center justify-end">Open <i className="fas fa-chevron-right ml-2 text-xs"></i></span>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}
                        
                        {/* Empty State */}
                        {filteredPolicies.length === 0 && (
                            <div className="text-center py-12 bg-white rounded-lg border border-gray-200 border-dashed">
                                <i className="fas fa-search text-4xl text-gray-300 mb-4"></i>
                                <p className="text-gray-500 text-lg">No policies found matching your search.</p>
                                <button onClick={() => setSearchTerm('')} className="mt-4 text-njra-500 hover:underline font-bold">Clear Search</button>
                            </div>
                        )}
                    </div>
                );
            };

            const QuizComponent = ({ policy }) => {
                const [qIndex, setQIndex] = useState(0);
                const [score, setScore] = useState(0);
                const [showResult, setShowResult] = useState(false);
                const [selected, setSelected] = useState(null);
                const [feedback, setFeedback] = useState(false);
                const [userName, setUserName] = useState("");

                const questions = policy.questions || [];
                if(questions.length === 0) return <div className="p-8 text-center">No questions configured.</div>;

                const q = questions[qIndex];
                const isPassed = (score / questions.length) >= 0.8;

                const handleAnswer = (idx) => {
                    setSelected(idx);
                    setFeedback(true);
                    if(idx === q.correctIndex) setScore(s => s + 1);
                };

                const next = () => {
                    setFeedback(false); setSelected(null);
                    if(qIndex < questions.length - 1) setQIndex(i => i + 1);
                    else setShowResult(true);
                };

                const sendEmail = () => {
                    const body = `Employee: ${userName}%0D%0APolicy: ${policy.title}%0D%0AScore: ${Math.round((score/questions.length)*100)}%`;
                    window.open(`mailto:admin@seeNJRA.com?subject=Competency Result&body=${body}`);
                };

                if(showResult) return (
                    <div className="max-w-xl mx-auto mt-8 bg-white p-8 rounded border border-gray-300 shadow-lg text-center">
                        <div className={`text-6xl mb-4 ${isPassed ? 'text-green-600' : 'text-njra-500'}`}>
                            <i className={`fas ${isPassed ? 'fa-check-circle' : 'fa-times-circle'}`}></i>
                        </div>
                        <h2 className="text-2xl font-bold mb-2 text-njra-900">{isPassed ? "Competency Passed" : "Competency Not Met"}</h2>
                        <p className="mb-6 text-gray-600">Score: {Math.round((score/questions.length)*100)}%</p>
                        
                        <div className="print-only border-4 border-double border-gray-800 p-8 m-4">
                            <h1 className="text-3xl font-serif mb-4 text-njra-500">Certificate of Completion</h1>
                            <p>This certifies that <strong>{userName}</strong> has demonstrated competency in:</p>
                            <h3 className="text-xl font-bold my-4 text-njra-900">{policy.title}</h3>
                            <p>{new Date().toLocaleDateString()}</p>
                        </div>

                        <div className="no-print space-y-4">
                            <input className="border border-gray-400 p-3 w-full rounded outline-none focus:border-njra-500 bg-gray-50" placeholder="Enter Your Full Name" value={userName} onChange={e=>setUserName(e.target.value)} />
                            <div className="flex gap-3 justify-center flex-col sm:flex-row">
                                <button onClick={sendEmail} disabled={!userName} className="njra-btn njra-btn-primary">Email Result</button>
                                {isPassed && <button onClick={()=>window.print()} className="njra-btn njra-btn-secondary">Print Certificate</button>}
                            </div>
                            <button onClick={()=>setView('detail')} className="block w-full text-gray-500 mt-4 hover:underline">Back to Policy</button>
                        </div>
                    </div>
                );

                return (
                    <div className="max-w-2xl mx-auto mt-8 bg-white p-6 rounded border border-gray-300 shadow-md">
                        <div className="flex justify-between mb-4 text-sm text-gray-600 font-medium">
                            <span>Question {qIndex + 1} of {questions.length}</span>
                            <span>Score: {score}</span>
                        </div>
                        <h3 className="text-lg font-bold mb-6 text-njra-900">{q.text}</h3>
                        <div className="space-y-3">
                            {q.options.map((opt, i) => (
                                <button key={i} disabled={feedback} onClick={()=>handleAnswer(i)} 
                                    className={`w-full text-left p-4 border rounded transition-all font-medium ${feedback ? (i === q.correctIndex ? 'bg-green-100 border-green-500 text-green-900' : (i === selected ? 'bg-red-50 border-njra-500 text-njra-900' : 'opacity-60')) : 'bg-gray-50 hover:bg-gray-100 border-gray-300 text-gray-700'}`}>
                                    {opt}
                                </button>
                            ))}
                        </div>
                        {feedback && <button onClick={next} className="mt-6 w-full njra-btn njra-btn-primary">Next</button>}
                    </div>
                );
            };

            const handleAdminLogin = (e) => {
                e.preventDefault();
                if(adminPass === "NJRA2025") { setIsAdmin(true); setShowAdminLogin(false); setView('admin'); }
                else { alert("Incorrect Code"); }
            };

            return (
                <div className="min-h-[600px] flex flex-col w-full njra-inner-content">
                    <nav className="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-40 no-print w-full rounded-b-lg">
                        <div className="px-4 py-4">
                            <div className="flex justify-between items-center w-full">
                                <div className="flex items-center cursor-pointer" onClick={() => setView('home')}>
                                    <span className="text-2xl mr-2 text-njra-500"><i className="fas fa-lungs"></i></span>
                                    <span className="text-xl font-bold text-njra-900">NJRA Portal</span>
                                </div>
                                <div className="flex items-center space-x-3">
                                    <button onClick={() => setView('home')} className={`njra-btn ${view === 'home' ? 'njra-btn-secondary' : 'njra-btn-outline'}`}>Policies</button>
                                    <button onClick={() => setShowAdminLogin(true)} className="text-gray-400 hover:text-njra-500 p-2"><i className="fas fa-lock"></i></button>
                                </div>
                            </div>
                        </div>
                    </nav>
                    
                    {status && <div className="bg-yellow-50 text-yellow-800 text-center text-xs py-2 border-b border-yellow-200">{status}</div>}

                    {!status && policies.length === 0 && view !== 'admin' && (
                        <div className="flex flex-col items-center justify-center p-12 text-center">
                            <div className="bg-white p-8 rounded-lg border border-gray-300 shadow-md max-w-lg">
                                <div className="text-njra-500 text-4xl mb-4"><i className="fas fa-database"></i></div>
                                <h2 className="text-xl font-bold mb-2 text-njra-900">Database Connected!</h2>
                                <p className="text-gray-600 mb-6">Your app is live, but the policy database is currently empty.</p>
                                <button onClick={() => { setShowAdminLogin(true); }} className="njra-btn njra-btn-primary">
                                    Go to Admin Dashboard to Import Data
                                </button>
                            </div>
                        </div>
                    )}

                    {showAdminLogin && (
                        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                            <div className="bg-white p-8 rounded-lg shadow-xl w-full max-w-sm border border-gray-200">
                                <h3 className="font-bold mb-6 text-xl text-njra-900 text-center">Admin Access</h3>
                                <form onSubmit={handleAdminLogin}>
                                    <input type="password" placeholder="Code (NJRA2025)" className="w-full border border-gray-300 p-3 mb-6 rounded outline-none focus:border-njra-500 bg-gray-50" value={adminPass} onChange={e=>setAdminPass(e.target.value)}/>
                                    <div className="flex justify-between gap-4">
                                        <button type="button" onClick={()=>setShowAdminLogin(false)} className="njra-btn njra-btn-secondary flex-1">Cancel</button>
                                        <button type="submit" className="njra-btn njra-btn-primary flex-1">Login</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}

                    <div className="w-full px-4 py-8 flex-grow">
                        {view === 'home' && (
                            <PolicyList policies={policies} onSelectPolicy={(p) => { setSelectedPolicy(p); setView('detail'); }} />
                        )}

                        {view === 'detail' && selectedPolicy && (
                            <div className="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden w-full">
                                <div className="bg-njra-900 text-white p-6 flex justify-between items-center">
                                    <div>
                                        <div className="text-gray-300 text-sm mb-1">{selectedPolicy.code}</div>
                                        <h1 className="text-2xl font-bold leading-tight text-white m-0 border-0">{selectedPolicy.title}</h1>
                                    </div>
                                    <button onClick={()=>setView('home')} className="text-gray-300 hover:text-white ml-4 flex-shrink-0"><i className="fas fa-times text-xl"></i></button>
                                </div>
                                <div className="p-4 bg-gray-50 flex justify-end gap-3 border-b border-gray-200 no-print">
                                    <button onClick={()=>window.print()} className="njra-btn njra-btn-secondary"><i className="fas fa-print mr-2"></i>Print</button>
                                    <button onClick={()=>setView('quiz')} className="njra-btn njra-btn-primary"><i className="fas fa-graduation-cap mr-2"></i>Take Quiz</button>
                                </div>
                                <div className="p-8 policy-content text-gray-800" dangerouslySetInnerHTML={{__html: selectedPolicy.content}}></div>
                            </div>
                        )}

                        {view === 'quiz' && selectedPolicy && <QuizComponent policy={selectedPolicy} />}
                        
                        {view === 'admin' && (
                            <div className="bg-white p-8 rounded border border-gray-200 shadow-md">
                                <div className="flex justify-between items-center mb-6 border-b pb-4">
                                    <h2 className="text-xl font-bold text-njra-900">Admin Dashboard</h2>
                                    <button onClick={() => setView('home')} className="njra-btn njra-btn-secondary text-sm">Exit Admin Dashboard</button>
                                </div>
                                
                                {showImport ? (
                                    <div className="mb-6">
                                        <p className="mb-2 text-sm text-gray-600">Paste the JSON code below to import policies. <br/><strong>Note:</strong> Policies with existing Codes (e.g. RT-004) will be updated automatically.</p>
                                        <textarea className="w-full border border-gray-300 p-2 h-48 font-mono text-xs rounded focus:border-njra-500 outline-none" placeholder='[{"title": "..."}]' value={importText} onChange={e=>setImportText(e.target.value)}></textarea>
                                        <div className="flex gap-3 mt-4 justify-end">
                                            <button onClick={()=>setShowImport(false)} className="njra-btn njra-btn-secondary">Cancel</button>
                                            <button onClick={handleImport} className="njra-btn njra-btn-primary">Run Smart Import</button>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="flex justify-start gap-4 mb-8">
                                        <button onClick={()=>setShowImport(true)} className="njra-btn njra-btn-primary"><i className="fas fa-file-import mr-2"></i>Import Policies</button>
                                    </div>
                                )}

                                <div>
                                    <h3 className="font-bold mb-4 text-njra-900">Current Database Policies ({policies.length})</h3>
                                    <ul>
                                        {(() => {
                                            // Apply same sorting as main page
                                            const sortedPolicies = [...policies].sort((a, b) => {
                                                const codeA = a.code || "";
                                                const codeB = b.code || "";
                                                return codeA.localeCompare(codeB) || a.title.localeCompare(b.title);
                                            });
                                            
                                            return sortedPolicies.map(p => (
                                                <li key={p.id} className="flex justify-between items-center py-3 border-b hover:bg-gray-50 px-2">
                                                    <span className="text-gray-800 font-medium">
                                                        <span className="font-mono text-xs text-gray-500 mr-2 w-16 inline-block">{p.code || '-'}</span>
                                                        {p.title}
                                                    </span>
                                                    <div className="flex items-center gap-2">
                                                        <button 
                                                            onClick={() => { setSelectedPolicy(p); setView('detail'); }} 
                                                            className="text-gray-500 hover:text-njra-500 p-2"
                                                            title="View Policy"
                                                        >
                                                            <i className="fas fa-eye"></i>
                                                        </button>
                                                        <button 
                                                            onClick={() => { setSelectedPolicy(p); setView('quiz'); }} 
                                                            className="text-gray-500 hover:text-njra-500 p-2"
                                                            title="View Quiz"
                                                        >
                                                            <i className="fas fa-graduation-cap"></i>
                                                        </button>
                                                        <button onClick={()=>handleDelete(p.id)} className="text-red-500 hover:text-red-700 p-2" title="Delete Policy">
                                                            <i className="fas fa-trash"></i>
                                                        </button>
                                                    </div>
                                                </li>
                                            ));
                                        })()}
                                    </ul>
                                </div>
                            </div>
                        )}
                    </div>
                    
                    <div className="text-center py-4 text-gray-400 text-xs mt-auto bg-white border-t border-gray-200">
                        &copy; {new Date().getFullYear()} NJRA Portal System
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('njra-app-root'));
        root.render(<App />);
    </script>
</body>
</html>
